# 使用 UMD

这是一个简单的示例，展示如何使用 Univer UMD 与协作、实时共享、打印、交换。

将它保存成一个html文件或者部署到你的服务器上，然后在浏览器中打开它，你就可以体验到 Univer Pro 的功能，请注意将 `universerEndpoint` 替换成你的 Universer 服务端地址。

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Univer UMD With Collaboration, Live Share, Print, Exchange
    </title>
    <script src="https://unpkg.com/@univerjs/umd/lib/univer.full.umd.js"></script>
    <script src="https://unpkg.com/@univerjs/umd/lib/locale/en-US.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@univerjs/umd/lib/univer.css">

    <script src="https://unpkg.com/lodash/lodash.js"></script>
    <script> window.lodash = _ </script>

    <script src="https://unpkg.com/@univerjs-pro/collaboration/lib/umd/index.js"></script>
    <script src="https://unpkg.com/@univerjs-pro/collaboration-client/lib/umd/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@univerjs-pro/collaboration-client/lib/index.css">

    <script src="https://unpkg.com/@univerjs-pro/live-share/lib/umd/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@univerjs-pro/live-share/lib/index.css">

    <script src="https://unpkg.com/@univerjs-pro/print/lib/umd/index.js"></script>
    <script src="https://unpkg.com/@univerjs-pro/sheets-print/lib/umd/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@univerjs-pro/sheets-print/lib/index.css">

    <script src="https://unpkg.com/@univerjs-pro/sheets-exchange-client/lib/umd/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@univerjs-pro/sheets-exchange-client/lib/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        #app {
            height: 100vh;
            width: 100vw;
        }
    </style>
</head>

<body>
    <div id="app"></div>

    <script>

        // Hi, developer, this is a simple example to show how to use Univer UMD with collaboration, live share, print, exchange
        // If you want to use the collaboration, live share, print, exchange, you need to config the endpoint
        // The endpoint is the univer backend server that provides the collaboration, live share, print, exchange service
        // You can deploy the universer server on your own server, see the deployment guide: https://univer.ai/zh-CN/pro/guides/sheet/deployment/docker

        const universerEndpoint = 'localhost:8000';

        // check if the unit is already created
        const url = new URL(window.location.href)
        const unit = url.searchParams.get('unit')
        if (unit) {
            Promise.all([
                fetch('https://unpkg.com/@univerjs-pro/collaboration-client/lib/locale/en-US.json').then(res => res.json()),
                fetch('https://unpkg.com/@univerjs-pro/sheets-print/lib/locale/en-US.json').then(res => res.json()),
                fetch('https://unpkg.com/@univerjs-pro/sheets-exchange-client/lib/locale/en-US.json').then(res => res.json())
            ]).then(([
                collaborationLocale,
                printLocale,
                exchangeLocale
            ]) => {
                setup({
                    ...collaborationLocale,
                    ...printLocale,
                    ...exchangeLocale
                });
            })
        } else {
            const { UniverInstanceType } = window.UniverCore;
            fetch(`http://${universerEndpoint}/universer-api/snapshot/${UniverInstanceType.UNIVER_SHEET}/unit/-/create`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    type: UniverInstanceType.UNIVER_SHEET,
                    name: 'New Sheet By Univer',
                    creator: 'user',
                }),
            }).then((response) => {
                if (!response.ok) {
                    throw new Error('Failed to create new sheet')
                }

                return response.json()
            }).then((data) => {
                if (!data.unitID) {
                    throw new Error('create unit failed')
                }

                url.searchParams.set('unit', data.unitID)
                url.searchParams.set('type', String(UniverInstanceType.UNIVER_SHEET))
                window.location.href = url.toString()
            }).catch((error) => {
                console.error(error)
            })
        }

        const setup = (extLocale) => {
            var {
                UniverCore,
                UniverDesign,
                UniverEngineRender,
                UniverEngineFormula,
                UniverDocs,
                UniverDocsUi,
                UniverUi,
                UniverSheets,
                UniverSheetsUi,
                UniverSheetsNumfmt,
                UniverCollaboration,
                UniverCollaborationClient
            } = window

            var univer = new UniverCore.Univer({
                theme: UniverDesign.defaultTheme,
                locale: UniverCore.LocaleType.EN_US,
                locales: {
                    [UniverCore.LocaleType.EN_US]: {
                        ...UniverUMD['en-US'],
                        ...extLocale
                    },
                },
                override: [
                    [UniverCore.IAuthzIoService, null],
                    [UniverCore.IUndoRedoService, null]
                ]
            });

            univer.registerPlugin(UniverEngineRender.UniverRenderEnginePlugin);
            univer.registerPlugin(UniverEngineFormula.UniverFormulaEnginePlugin);

            univer.registerPlugin(UniverUi.UniverUIPlugin, {
                container: "app",
            });

            univer.registerPlugin(UniverDocs.UniverDocsPlugin, {
                hasScroll: false,
            });
            univer.registerPlugin(UniverDocsUi.UniverDocsUIPlugin);

            univer.registerPlugin(UniverSheets.UniverSheetsPlugin);
            univer.registerPlugin(UniverSheetsUi.UniverSheetsUIPlugin);


            //   pro
            const injector = univer.__getInjector();
            const configService = injector.get(UniverCore.IConfigService);

            // debug via reverse proxy
            const { SNAPSHOT_SERVER_URL_KEY, COLLAB_SUBMIT_CHANGESET_URL_KEY, COLLAB_WEB_SOCKET_URL_KEY, AUTHZ_URL_KEY } = UniverCollaborationClient;


            // config collaboration endpoint
            configService.setConfig(AUTHZ_URL_KEY, `http://${universerEndpoint}/universer-api/authz`);
            configService.setConfig(SNAPSHOT_SERVER_URL_KEY, `http://${universerEndpoint}/universer-api/snapshot`);
            configService.setConfig(COLLAB_SUBMIT_CHANGESET_URL_KEY, `http://${universerEndpoint}/universer-api/comb`);
            configService.setConfig(COLLAB_WEB_SOCKET_URL_KEY, `ws://${universerEndpoint}/universer-api/comb/connect`);

            // collaboration
            univer.registerPlugin(UniverCollaboration.UniverCollaborationPlugin);
            univer.registerPlugin(UniverCollaborationClient.UniverCollaborationClientPlugin);


            univer.registerPlugin(UniverLiveShare.UniverLiveSharePlugin)

            // print
            univer.registerPlugin(UniverSheetsPrint.UniverSheetsPrintPlugin)

            // config exchange endpoint
            const { EXCHANGE_UPLOAD_FILE_SERVER_URL_KEY, EXCHANGE_IMPORT_SERVER_URL_KEY, EXCHANGE_EXPORT_SERVER_URL_KEY, EXCHANGE_GET_TASK_SERVER_URL_KEY, EXCHANGE_SIGN_URL_SERVER_URL_KEY } = UniverSheetsExchangeClient;
            configService.setConfig(EXCHANGE_UPLOAD_FILE_SERVER_URL_KEY, `http://${universerEndpoint}/universer-api/stream/file/upload`);
            configService.setConfig(EXCHANGE_IMPORT_SERVER_URL_KEY, `http://${universerEndpoint}/universer-api/exchange/{type}/import`);
            configService.setConfig(EXCHANGE_EXPORT_SERVER_URL_KEY, `http://${universerEndpoint}/universer-api/exchange/{type}/export`);
            configService.setConfig(EXCHANGE_GET_TASK_SERVER_URL_KEY, `http://${universerEndpoint}/universer-api/exchange/task/{taskID}`);
            configService.setConfig(EXCHANGE_SIGN_URL_SERVER_URL_KEY, `http://${universerEndpoint}/universer-api/file/{fileID}/sign-url`);
            // exchange
            univer.registerPlugin(UniverSheetsExchangeClient.UniverSheetsExchangeClientPlugin)
        }

    </script>
</body>

</html>
```
