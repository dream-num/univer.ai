---
title: è§£å‰–ç­›é€‰ï¼šå¦‚ä½•ç¼–å†™ Univer æ’ä»¶
desc: è¿™ç¯‡æ–‡ç« ä»¥ Univer å›¢é˜Ÿå¼€å‘çš„ç­›é€‰æ’ä»¶ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ç¼–å†™ç¬¦åˆ Univer æ¶æ„çš„æ’ä»¶ï¼Œæ¶‰åŠæ’ä»¶ç³»ç»Ÿã€ä¾èµ–æ³¨å…¥ã€èµ„æºåŠ è½½ã€å‘½ä»¤æ¨¡å¼ã€Render Unit ç­‰ç­‰ä¸»é¢˜ï¼Œé€‚åˆæƒ³è¦å¼€å‘ Univer æ’ä»¶çš„å¼€å‘è€…é˜…è¯»ã€‚
tags:
  - Plugin
  - Tutorial
  - Custom
  - Architecture
cover: ./anatomy.png
author: Wenzhao Hu
date: 2024-08-27
---

import { Callout } from 'nextra/components'

# è§£å‰–ç­›é€‰ï¼šå¦‚ä½•ç¼–å†™ Univer æ’ä»¶

Univer æä¾›çš„ Facade API ä½¿å¾—å¼€å‘è€…ä»¬å¯ä»¥è°ƒç”¨ API æ¥å®ç°ç®€å•çš„è‡ªå®šä¹‰åŠŸèƒ½ã€‚ä½†å¦‚æœæƒ³å¼€å‘ä¸€ä¸ªå…¨æ–°çš„åŠŸèƒ½ï¼Œæˆ–æ ¹æ®éœ€æ±‚è¿›è¡Œæ·±åº¦å®šåˆ¶ï¼Œé‚£ä¹ˆå°±éœ€è¦äº†è§£ Univer çš„æ¶æ„ï¼Œå¹¶å­¦ä¹ å¦‚ä½•ç¼–å†™ç¬¦åˆæ¶æ„çš„æ’ä»¶ã€‚

æˆ‘ä»¬å°†ä»¥å®˜æ–¹ç­›é€‰æ’ä»¶ä¸ºä¾‹è¿›è¡Œä»‹ç»å¦‚ä½•ç¼–å†™ä¸€ä¸ª Univer æ’ä»¶ï¼Œæ¶‰åŠæ’ä»¶ç³»ç»Ÿã€ä¾èµ–æ³¨å…¥ã€èµ„æºåŠ è½½ã€å‘½ä»¤æ¨¡å¼ã€Render Unit ç­‰ä¸»é¢˜ã€‚

ä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ° [@univerjs/sheets-filter](https://github.com/dream-num/univer/tree/dev/packages/sheets-filter) å’Œ [@univerjs/sheets-filter-ui](https://github.com/dream-num/univer/tree/dev/packages/sheets-filter-ui) ä¸¤ä¸ªåŒ…çš„æºç ã€‚

<Callout type="info" emoji="ğŸ’¡">
  ç›®å‰æˆ‘ä»¬å¹¶æ²¡å¯¹ npm åŒ…å’Œ Univer æ’ä»¶åšä¸¥æ ¼åŒºåˆ†ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¯´æ’ä»¶æ—¶ï¼ŒæŒ‡çš„æœ‰å¯èƒ½æ˜¯ npm åŒ…ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿™ä¸ªåŒ…å¯¼å‡ºçš„ `Plugin` ç±»ï¼Œè¯·æ³¨æ„ã€‚
</Callout>

## æ’ä»¶çš„ç»“æ„

### å¦‚ä½•åˆ’åˆ†æ’ä»¶

ä¸€ä¸ªå¤æ‚çš„åŠŸèƒ½å¾€å¾€ä¼šæ‹†åˆ†åœ¨å¤šä¸ª npm åŒ…ä¸­ï¼Œç­›é€‰åŠŸèƒ½æœ‰ä¸¤ä¸ª npm åŒ…ï¼š

@univerjs/sheets-filter 

* å®šä¹‰ç­›é€‰çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ä»¥åŠå¿«ç…§ä¸­çš„æ•°æ®ç»“æ„
* å®šä¹‰æ”¹å˜ç­›é€‰æ•°æ®çš„ mutations
* å®ç°ç­›é€‰å’Œ sheet åŸºæœ¬åŠŸèƒ½çš„è€¦åˆé€»è¾‘ï¼ˆä¾‹å¦‚ç­›é€‰å’Œæ’å…¥è¡Œåˆ—çš„è”åŠ¨ï¼‰
* æä¾›ç®¡ç†å¤šä¸ªå·¥ä½œç°¿å’Œå·¥ä½œè¡¨ä¸­ç­›é€‰æ¨¡å‹çš„ `SheetsFilterModel`
* å°†ä»¥ä¸Šæ¨¡å—å°è£…åœ¨ `UniverSheetsFilterPlugin` å½“ä¸­

@univerjs/sheets-filter-ui

* å®ç°ç­›é€‰åŠŸèƒ½çš„æ¸²æŸ“ï¼ŒåŒ…æ‹¬ç­›é€‰é€‰åŒºï¼Œç­›é€‰æŒ‰é’®
* å®ç°ç­›é€‰åŠŸèƒ½çš„ UIï¼ŒåŒ…æ‹¬ç­›é€‰é¢æ¿ã€èœå•æ 
* å®ç°å…¶ä»–äº¤äº’ï¼Œä¾‹å¦‚å¿«æ·é”®
* æä¾›ç®¡ç†ç­›é€‰é¢æ¿çš„ `SheetsFilterPanelService`
* å°†ä»¥ä¸Šæ¨¡å—å°è£…åœ¨ `UniverSheetsFilterUIPlugin` å½“ä¸­

æ‹†åˆ†æˆä¸¤ä¸ªåŒ…çš„åŸå› æ˜¯ï¼š `@univerjs/sheets-filter-ui` ä¸­çš„ä»£ç éœ€è¦ä¾èµ– DOMï¼Œè€Œ `@univerjs/sheets-filter` ä¸­çš„ä»£ç æ˜¯çº¯é€»è¾‘ä»£ç ï¼Œä¸ä¾èµ– DOMï¼Œå¯ä»¥åœ¨ Node.js å’Œ Web Worker ç¯å¢ƒä¸­è¿è¡Œï¼Œç”¨äºååŒç¼–è¾‘ã€è¿œç«¯è®¡ç®—ç­‰åœºæ™¯ã€‚é€šè¿‡æ‹†åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å¤ç”¨ `@univerjs/sheets-filter` çš„ä»£ç ï¼Œæ¥å‘æŒ¥ Univer æ¶æ„çš„åŒæ„ä¼˜åŠ¿ã€‚

<Callout type="info" emoji="ğŸ’¡">
  å…³äºå¦‚ä½•åˆ’åˆ†æ’ä»¶ï¼Œå¯ä»¥å‚è€ƒæ¶æ„æ–‡æ¡£çš„ [ç›¸å…³ç« èŠ‚](guides/sheet/architecture/univer#å¦‚ä½•åˆ’åˆ†æ’ä»¶)ã€‚
</Callout>

### æ’ä»¶çš„ç›®å½•ç»“æ„

æ¯ä¸ªæ’ä»¶æœ‰ç›¸ä¼¼çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚ sheets-filter-ui çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```plaintext
.
|-- README.md
|-- package.json
|-- src
|   |-- __testing__ // æµ‹è¯•èµ„æºæ–‡ä»¶
|   |   `-- data.ts
|   |-- commands
|   |   |-- commands // CommandType.COMMAND ç±»å‹çš„å‘½ä»¤
|   |   `-- operations // CommandType.OPERATION ç±»å‹çš„å‘½ä»¤
|   |-- controllers
|   |   |-- __tests__ // æµ‹è¯•ç”¨ä¾‹
|   |   |-- sheets-filter-permission.controller.ts // æƒé™ç›¸å…³é€»è¾‘
|   |   |-- sheets-filter-ui-desktop.controller.ts // æ¡Œé¢ç«¯ UI
|   |   |-- sheets-filter-ui-mobile.controller.ts // ç§»åŠ¨ç«¯ UI
|   |   |-- sheets-filter.menu.ts // èœå•é¡¹
|   |   `-- sheets-filter.shortcut.ts // å¿«æ·é”®
|   |-- filter-ui-desktop.plugin.ts // æ¡Œé¢ç«¯æ’ä»¶
|   |-- filter-ui-mobile.plugin.ts // ç§»åŠ¨ç«¯æ’ä»¶ï¼ˆå®éªŒæ€§è´¨ã€æœªå…¬å¼€å‘å¸ƒï¼‰
|   |-- index.ts // åŒ…å…¥å£æ–‡ä»¶ï¼Œèµ„æºä»è¿™é‡Œå¯¼å‡º
|   |-- locale // å›½é™…åŒ–èµ„æº
|   |   |-- en-US.ts
|   |   |-- ru-RU.ts
|   |   |-- vi-VN.ts
|   |   |-- zh-CN.ts
|   |   `-- zh-TW.ts
|   |-- models // æ•°æ®æ¨¡å‹ï¼Œä¸ºç­›é€‰é…ç½®é¢æ¿æ‰€ç”¨
|   |   |-- __tests__
|   |   |-- conditions.ts
|   |   |-- extended-operators.ts
|   |   `-- utils.ts
|   |-- services
|   |   |-- __tests__
|   |   `-- sheets-filter-panel.service.ts // ç®¡ç†ç­›é€‰é…ç½®é¢æ¿çŠ¶æ€å’Œè¡¨å•æ•°æ®çš„æœåŠ¡
|   |-- views
|   |   |-- components // React ç»„ä»¶
|   |   |-- render-modules // æ¸²æŸ“æ¨¡å—
|   |   `-- widgets // Canvas ç»˜åˆ¶çš„ç»„ä»¶
|   |-- vite-env.d.ts
|   `-- worker // åœ¨ Web Worker ä¸­è¿è¡Œçš„ä»£ç 
|       |-- generate-filter-values.service.ts // è®¡ç®—ç­›é€‰é¢æ¿ä¸­çš„é€‰é¡¹
|       `-- plugin.ts
|-- tsconfig.json
|-- tsconfig.node.json
`-- vite.config.ts
```

ç›®å½•ç»“æ„åŸºæœ¬éµä»äº† Univer çš„åˆ†å±‚æ¨¡å‹ï¼Œèƒ½è®©ç†Ÿæ‚‰ Univer çš„å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ï¼Œæœ‰åŠ©äºä»£ç çš„ç»´æŠ¤ã€‚

ä½œä¸ºå¯¹æ¯”ï¼Œsheets-filter æ’ä»¶æœ‰ç›¸ä¼¼çš„ç›®å½•ç»“æ„ï¼š

```plaintext
.
|-- README.md
|-- docs
|   |-- README.md
|   `-- architecture.excalidraw
|-- package.json
|-- src
|   |-- commands
|   |   `-- mutations // CommandType.MUTATION ç±»å‹çš„å‘½ä»¤
|   |-- controllers
|   |   `-- sheets-filter.controller.ts // å’Œç”µå­è¡¨æ ¼åŸºç¡€åŠŸèƒ½è€¦åˆçš„éƒ¨åˆ†ï¼Œä¾‹å¦‚æ’å…¥è¡Œåˆ—æ—¶ä¿®æ”¹ç­›é€‰èŒƒå›´
|   |-- index.ts
|   |-- models // ç­›é€‰æ•°æ®æ¨¡å‹
|   |   |-- __tests__
|   |   |-- custom-filters.ts // æ¡ä»¶ç­›é€‰
|   |   |-- filter-model.ts // è¿è¡Œæ—¶ç­›é€‰æ•°æ®ç»“æ„
|   |   `-- types.ts // å¿«ç…§æ•°æ®ç»“æ„
|   |-- plugin.ts
|   |-- services
|   |   `-- sheet-filter.service.ts // ç®¡ç†å¤šä¸ªå·¥ä½œç°¿å’Œå·¥ä½œè¡¨ä¸­ç­›é€‰æ¨¡å‹çš„æœåŠ¡
|   |-- utils.ts
|   `-- vite-env.d.ts
|-- tsconfig.json
|-- tsconfig.node.json
`-- vite.config.ts
```

<Callout type="info" emoji="ğŸ’¡">
  è¿›ä¸€æ­¥äº†è§£ Univer æ¶æ„ä¸­çš„ [åˆ†å±‚æ¨¡å‹](/guides/sheet/architecture/univer#ä»¥åˆ†å±‚æ¶æ„åˆ’åˆ†æ¨¡å—)ã€‚
</Callout>

<Callout type="info" emoji="ğŸ’¡">
  ä½ å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ [CLI å·¥å…·](https://www.npmjs.com/package/@univerjs/create-cli) æ¥åˆ›å»ºæ’ä»¶ã€‚
</Callout>

## è‡ªå®šä¹‰æ•°æ®

éœ€è¦è‡ªå®šä¹‰æ•°æ®çš„æ’ä»¶éœ€è¦è®¾è®¡ï¼šå¿«ç…§æ•°æ®ç»“æ„ã€å†…å­˜æ•°æ®ç»“æ„ä»¥åŠä¿®æ”¹è¿™äº›æ•°æ®ç»“æ„çš„ mutationï¼Œä»¥æ¥å…¥ Univer ç³»ç»Ÿã€‚

### å¿«ç…§æ•°æ®ç»“æ„

å¿«ç…§ä¸­çš„æ•°æ®ç»“æ„å°†ä¼šè¢«å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤å¿«ç…§æ•°æ®ç»“æ„å¿…é¡»æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ã€‚ç­›é€‰æ’ä»¶å®šä¹‰çš„å¿«ç…§æ•°æ®æ ¼å¼åœ¨ [types.ts](https://github.com/dream-num/univer/blob/dev/packages/sheets-filter/src/models/types.ts) ä¸­ã€‚`IAutoFilter` åªä½¿ç”¨äº†åŸºæœ¬æ•°æ®ç»“æ„ï¼Œå› æ­¤å¯ä»¥è¢« JSON ç®€å•çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚

<Callout type="info" emoji="ğŸ’¡">
  å®˜æ–¹æ–‡æ¡£ä¸­ä»‹ç»äº† [å¿«ç…§](/guides/sheet/getting-started/concepts#å¿«ç…§) çš„æ¦‚å¿µã€‚
</Callout>

<Callout type="info" emoji="ğŸ’¡">
  Univer å®˜æ–¹å®ç°çš„ sheet åŠŸèƒ½æ’ä»¶åœ¨å®šä¹‰å¿«ç…§æ•°æ®ç»“æ„æ—¶ä¼šå‚è€ƒ [OOXML è§„èŒƒ](http://officeopenxml.com/)ï¼Œä»¥ä¾¿å’Œ Excel å…¼å®¹ã€‚
</Callout>

### å†…å­˜æ•°æ®ç»“æ„

å¿«ç…§æ•°æ®ç»“æ„å¯èƒ½ä¸é€‚å®œç›´æ¥åœ¨å†…å­˜ä¸­ä½¿ç”¨ï¼ˆä¾‹å¦‚æ‰§è¡ŒæŸ¥è¯¢ã€ä¿®æ”¹çš„æ—¶é—´å¤æ‚åº¦é«˜ï¼‰ï¼Œå› æ­¤éœ€è¦å®šä¹‰ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„ã€‚ç­›é€‰æ’ä»¶å®šä¹‰çš„å†…å­˜æ•°æ®ç»“æ„åœ¨ [filter-model.ts](https://github.com/dream-num/univer/blob/dev/packages/sheets-filter/src/models/filter-model.ts) ä¸­ã€‚

### `IResourcesManagerService`

å®šä¹‰äº†ä¸¤ç§æ•°æ®ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆé€‚çš„æ—¶æœºå°†å¿«ç…§æ•°æ®ç»“æ„è½¬æ¢ä¸ºå†…å­˜æ•°æ®ç»“æ„æˆ–è€…ç›¸åï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦é€šè¿‡ `IResourceManagerService` æ¥å®Œæˆã€‚ç­›é€‰åŠŸèƒ½åœ¨ [sheets-filter.service.ts](https://github.com/dream-num/univer/blob/f68e8ebe85db46801dd579e2f2d772c8ab9d18fc/packages/sheets-filter/src/services/sheet-filter.service.ts#L186) å®šä¹‰äº†ç›¸å…³æ“ä½œã€‚

<Callout type="info" emoji="ğŸ’¡">
  å¯å‚è€ƒ [æ’ä»¶è‡ªå®šä¹‰æ¨¡å‹](/guides/sheet/advanced/custom-model) äº†è§£è¯¦æƒ…ã€‚
</Callout>

### mutations

åœ¨ Univer ä¸­ï¼Œå¯¹æ•°æ®ç»“æ„çš„ä¿®æ”¹å‡éœ€è¦é€šè¿‡ MUTATION ç±»å‹çš„å‘½ä»¤æ¥å®Œæˆï¼Œå¦åˆ™æ— æ³•å®ç° undo redoã€ååŒç¼–è¾‘ã€å†å²è®°å½•ç­‰åŠŸèƒ½ã€‚ç­›é€‰çš„ mutation å®šä¹‰åœ¨ [sheets-filter.mutation.ts](https://github.com/dream-num/univer/blob/dev/packages/sheets-filter/src/commands/mutations/sheets-filter.mutation.ts) ä¸­ã€‚

<Callout type="info" emoji="ğŸ’¡">
  è¯·é˜…è¯» [å‘½ä»¤ç³»ç»Ÿ](/guides/sheet/architecture/univer#å‘½ä»¤ç³»ç»Ÿ) äº†è§£è¯¦æƒ…ã€‚
</Callout>

## å’Œ sheet åŸºç¡€åŠŸèƒ½çš„è€¦åˆ

æ’ä»¶çš„åŠŸèƒ½å¾€å¾€éœ€è¦å’Œ sheet åŸºç¡€åŠŸèƒ½è€¦åˆï¼Œç­›é€‰æ’ä»¶çš„è€¦åˆé€»è¾‘ä½äº [sheets-filter.controller.ts](https://github.com/dream-num/univer/blob/dev/packages/sheets-filter/src/controllers/sheets-filter.controller.ts) ä¸­ã€‚

<Callout emoji="ğŸ¤”">
  åœ¨å¤„ç†å’Œ sheet åŸºç¡€åŠŸèƒ½è€¦åˆçš„é€»è¾‘æ—¶ï¼Œå¾€å¾€éœ€è¦è°ƒç”¨ [`SheetInterceptorService`](/typedoc/@univerjs/sheets/classes/SheetInterceptorService) çš„ç›¸å…³æ–¹æ³•ï¼Œå¯å‚è€ƒ API æ–‡æ¡£å’Œå·²æœ‰æ’ä»¶çš„ä½¿ç”¨ã€‚
</Callout>

## æ¸²æŸ“

### Sheet é€‰åŒºå’ŒæŒ‰é’®

Univer å…è®¸åŠŸèƒ½æ’ä»¶è‡ªå®šä¹‰æ¸²æŸ“ï¼Œç­›é€‰æ’ä»¶çš„æ¸²æŸ“æ¨¡å—ä½äº [sheets-filter.render-controller.ts](https://github.com/dream-num/univer/blob/dev/packages/sheets-filter-ui/src/views/widgets/render-modules/sheets-filter.render-controller.ts)ã€‚

`SheetsFilterRenderController` æ˜¯ä¸€ä¸ª `IRenderModule`ï¼Œå®ƒå®šä¹‰äº†æ¸²æŸ“ç­›é€‰é€‰åŒºå’ŒæŒ‰é’®çš„é€»è¾‘ã€‚

<Callout type="info" emoji="ğŸ’¡">
  è¯·é˜…è¯» [æ¸²æŸ“å¼•æ“æ¶æ„è®¾è®¡](/guides/sheet/architecture/rendering) äº†è§£å¦‚ä½•æ’°å†™æ¸²æŸ“å±‚ä»£ç ã€‚
</Callout>

### è®©ç­›é€‰è¡Œéšè—



## å¼€å‘ UI

### èœå•é¡¹

### å¿«æ·é”®

### æµ®åŠ¨é¢æ¿

## ä½œä¸ºå°è£…çš„æ’ä»¶

### æ³¨å†Œæ¨¡å—

### å¤„ç†ç”Ÿå‘½å‘¨æœŸ

## å›½é™…åŒ–

## Facade API

## æ€»ç»“

<p className="text-gray-500 text-sm mt-8">ä½œè€…ï¼š[Wenzhao Hu](https://github.com/wzhudev)ï¼ŒHead of Engineering</p>
