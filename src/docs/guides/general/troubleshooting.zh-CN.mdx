import BadgeGroup, { UniverTypes } from '@/components/BadgeGroup'
import Image from '@/components/Image'
import clipboardImg from './troubleshooting/clipboard.png'
import missingLocaleImg from './troubleshooting/missing-locale.png'

# å¸¸è§é—®é¢˜

<BadgeGroup values={[UniverTypes.GENERAL]} value={UniverTypes.GENERAL} />

## å®‰è£…ç›¸å…³

### ä¸ºä»€ä¹ˆæˆ‘åœ¨ä½¿ç”¨ webpack 4 çš„é¡¹ç›®ä¸­å¯¼å…¥ Univer ä¼šæŠ¥é”™ï¼Ÿ

- webpack 4 æ— æ³•æ­£ç¡®åœ°è¯†åˆ« `packages.json` çš„ `exports` å­—æ®µï¼Œè¯¦è§ [webpack/webpack#9509](https://github.com/webpack/webpack/issues/9509)ã€‚
ä½ éœ€è¦æ‰¾åˆ°æ­£ç¡®è·¯å¾„å¹¶æ‰‹åŠ¨å¼•å…¥ã€‚éƒ¨åˆ†ç¬¬ä¸‰æ–¹ä¾èµ–å¯èƒ½éœ€è¦é€šè¿‡é…ç½® `resolve.alias` å»ºç«‹åˆ«åæ¥è§£å†³ã€‚
- åœ¨æŸäº› webpack 4 è„šæ‰‹æ¶ä¸­ï¼Œé»˜è®¤çš„ babel çš„é…ç½®å¯èƒ½ä¸å¤„ç† node_modules ä¸‹çš„ä¾èµ–ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ webpack çš„ rulesï¼Œå°† `@univerjs/*` æ·»åŠ åˆ° babel-loader çš„ `include` é…ç½®ä¸­ã€‚

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŸºäº webpack 4 çš„[åœ¨çº¿ demo](/playground?title=Webpack%204)ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©ä½ è§£å†³è¿™ä¸ªé—®é¢˜

### ä¸ºä»€ä¹ˆä½¿ç”¨ `<script>` å¼•å…¥ Univer UMD åŒ…æ—¶ï¼Œéƒ¨åˆ†æ’ä»¶æ³¨å†Œæ—¶ä¼šæŠ¥é”™ï¼Ÿ

- è¯·ç¡®ä¿ä½ æŒ‰é¡ºåºå¼•å…¥äº†æ’ä»¶æ‰€ç”¨åˆ°çš„å‰ç½®ä¾èµ–ã€‚
- å¯åœ¨æ’ä»¶çš„æ–‡æ¡£é¡µæˆ–æ’ä»¶æºç çš„ `packages.json` çš„ `peerDependencies` å­—æ®µä¸­æ‰¾åˆ°æ’ä»¶è¿è¡Œæ‰€éœ€è¦çš„å‰ç½®ä¾èµ–é¡¹ã€‚

### ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨ npm æˆ–è€… yarn å®‰è£…ï¼Œè¿è¡Œæ—¶æŠ¥é”™æ‰¾ä¸åˆ°ä¾èµ–ï¼Ÿ

è¿™å¯èƒ½æ˜¯å› ä¸ºä½ ä½¿ç”¨çš„ node åŒ…ç®¡ç†å·¥å…·ç‰ˆæœ¬è¾ƒä½å¯¼è‡´ï¼Œ yarn å’Œ npm@6 ä¸ä¼šè‡ªåŠ¨å®‰è£… `packages.json` ä¸­çš„ `peerDependencies`ï¼Œè¯¦è§ [package-json#peerdependencies](https://docs.npmjs.com/cli/v10/configuring-npm/package-json#peerdependencies)ã€‚

- ä½ å¯ä»¥è‡ªè¡Œå®‰è£…ç¼ºå¤±çš„é™„å±ä¾èµ–é¡¹ã€‚
- å¯¹äº npm ç”¨æˆ·ï¼Œå¯å°† node ç‰ˆæœ¬æ›´æ–°è‡³ 16 ä»¥ä¸Šï¼Œäº¦æˆ–è€…å°† npm ç‰ˆæœ¬å‡çº§è‡³ 7 åŠä»¥ä¸Šï¼Œå¹¶ç•™æ„å‡çº§è¡Œä¸ºå¯èƒ½å¯¹ä½ å·²æœ‰é¡¹ç›®çš„å½±å“ã€‚

## ä½¿ç”¨ç›¸å…³

### å¤åˆ¶ç²˜è´´ / å‰ªè´´æ¿

#### ä¸ºä»€ä¹ˆåœ¨ Firefox é‡Œæ— æ³•ä½¿ç”¨å³é”®ä¸­èœå•çš„ç²˜è´´ï¼Ÿ

Firefox å°šä¸æ”¯æŒ `clipboard.readText()`ï¼Œè¯¦è§ [MDN](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/readText)ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒUniver åªèƒ½ä»ç²˜è´´äº‹ä»¶ä¸­è·å–å‰ªè´´æ¿å†…å®¹ï¼Œå› æ­¤åªèƒ½æ”¯æŒå¿«æ·é”®ç²˜è´´ã€‚

#### æˆ‘ä½¿ç”¨ Chrome æµè§ˆå™¨ï¼Œä½†æ˜¯æ— æ³•ä½¿ç”¨å³é”®ä¸­èœå•çš„ç²˜è´´ï¼Ÿ

é¦–å…ˆè¯·ç¡®ä¿ä½ çš„æµè§ˆå™¨ç‰ˆæœ¬åœ¨ 66 ä»¥ä¸Šï¼Œç„¶åè¯·ç¡®ä¿ä½ çš„ç½‘ç«™æ˜¯é€šè¿‡ HTTPS åè®®è®¿é—®çš„ï¼Œç”±äº Chrome çš„å®‰å…¨ç­–ç•¥ï¼Œåªæœ‰åœ¨ HTTPS åè®®ä¸‹æ‰èƒ½ä½¿ç”¨ `clipboard` APIã€‚

#### ä¸ºä»€ä¹ˆæˆ‘æ— æ³•è¿›è¡Œå¤åˆ¶ç²˜è´´ï¼Ÿ

åœ¨ Chrome å’Œ Safari ç­‰æ”¯æŒ `clipboard.readText()` çš„æµè§ˆå™¨ä¸­ï¼ŒUniver ä¼šç›´æ¥å°è¯•è·å–å‰ªè´´æ¿å†…å®¹ï¼Œè¯·ç¡®ä¿æ“ä½œçš„ç”¨æˆ·æˆäºˆäº† Univer æµè§ˆå™¨çš„å‰ªè´´æ¿æƒé™ã€‚

<Image src={clipboardImg} alt="Authorize Clipboard" width={500} />

## å¼€å‘ç›¸å…³

### ä¸ºä»€ä¹ˆæˆ‘çš„èœå•é¡¹ä¸­æ²¡æœ‰æ˜¾ç¤ºæ­£ç¡®çš„è¯­è¨€ï¼Ÿ

è¿™æ˜¯å› ä¸ºä½ é—æ¼äº†å¯¹åº”çš„è¯­è¨€åŒ…ï¼Œä½ éœ€è¦åœ¨åˆå§‹åŒ– Univer æ—¶ä¼ å…¥å¯¹åº”çš„è¯­è¨€åŒ…ï¼Œè¯¦æƒ…è¯·å‚è€ƒå„ä¸ªåŠŸèƒ½é¡¹ä¸­å›½é™…åŒ–ç›¸å…³çš„æ–‡æ¡£ã€‚

<Image src={missingLocaleImg} alt="Missing Locale" width={300} />

### ğŸ“Š å¦‚ä½•å®æ—¶è·å–å•å…ƒæ ¼ç¼–è¾‘å™¨å†…çš„æ•°æ®ï¼Ÿ

Univer Sheet çš„å•å…ƒæ ¼ç¼–è¾‘å™¨æœ¬è´¨ä¸Šå°±æ˜¯ Univer Doc çš„ç¼–è¾‘å™¨ï¼Œå› æ­¤ä½ å¯ä»¥é€šè¿‡ Facade API è·å–å½“å‰æ¿€æ´»çš„ Univer Doc ç¼–è¾‘å™¨å†…çš„ snapshot æ•°æ®ã€‚

```typescript
univerAPI.onCommandExecuted((command) => {
  const { id } = command;
  if (id === 'doc.command.insert-text' || id === 'doc.command.delete-text') {
    const doc = univerAPI.getActiveDocument();
    if (doc) {
      const snapshot = doc.getSnapshot();
      console.log(snapshot.body?.dataStream);
    }
  }
});
```

å‚è€ƒï¼šhttps://github.com/dream-num/univer/discussions/2261

### ğŸ“Š å•å…ƒæ ¼ç¼–è¾‘å™¨èšç„¦æ—¶ç‚¹å‡»å¤–éƒ¨æŒ‰é’®è§¦å‘äº‹ä»¶ï¼Œè·å–çš„ snapshot ä¸­æœªåŒ…å«è¯¥èšç„¦å•å…ƒæ ¼çš„æ•°æ®

å•å…ƒæ ¼çš„æ•°æ®ä¼šåœ¨å¤±ç„¦æ—¶åŒæ­¥åˆ° snapshot ä¸­ï¼Œå› æ­¤ä½ åº”å½“åœ¨è·å– snapshot æ•°æ®å‰å…ˆå¯¹å•å…ƒæ ¼è¿›è¡Œå¤±ç„¦æ“ä½œã€‚

```typescript
import { DeviceInputEventType } from '@univerjs/engine-render';
import { FUniver } from '@univerjs/facade';

const univerAPI = FUniver.newAPI(univer);

$btn.addEventListener('click', () => {
  univerAPI.executeCommand('sheet.operation.set-cell-edit-visible', {
    visible: false,
    _eventType: DeviceInputEventType.PointerUp,
  });
});
```

å‚è€ƒï¼šhttps://github.com/dream-num/univer/issues/1314

## é›†æˆç›¸å…³

### ä½¿ç”¨ React

é¦–å…ˆè¯·ç¡®ä¿ä½ çš„ React ç‰ˆæœ¬åœ¨ 16.9 ä»¥ä¸Šï¼Œå› ä¸º Univer çš„ UI å±‚ä¾èµ– Reactï¼Œå¹¶ä¸”ä½¿ç”¨äº† React Hooksã€‚

æ­¤å¤–ï¼Œå—é™äº Univer DI æœºåˆ¶ï¼Œæš‚æ—¶ä¸æ”¯æŒ React çš„ StrictModeï¼Œé€šè¿‡ç§»é™¤ StrictMode å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```diff
- <React.StrictMode>
  <App />
- </React.StrictMode>
```

### ä½¿ç”¨ Angular

ä½¿ç”¨ Angular CLI é»˜è®¤åˆ›å»ºçš„é¡¹ç›®æ¨¡æ¿å¼•å…¥ Univer å‰éœ€è¦ç¡®ä¿æ˜¯å¦åœ¨ `tsconfig.json` ä¸­é…ç½®äº† `"skipLibCheck": true`ï¼š

```diff
{
  "compilerOptions": {
+    "skipLibCheck": true
  }
}
```

## æ•…éšœæ’æŸ¥

### Error: [ThemeService]: current theme is not set!

```
Error: [ThemeService]: current theme is not set!
```

å‡ºç°è¯¥é”™è¯¯çš„åŸå› æ˜¯å› ä¸ºä½ åœ¨ä½¿ç”¨ Univer æ—¶æ²¡æœ‰è®¾ç½®ä¸»é¢˜ã€‚ä½ éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥è®¾ç½®ä¸»é¢˜ï¼š

```typescript {2}
const univer = new Univer({
  theme: defaultTheme,
  locale: LocaleType.ZH_CN,
  locales: {
      [LocaleType.ZH_CN]: zhCN,
  },
});
```

### Error: [LocaleService]: Locale not initialized

```
Error: [LocaleService]: Locale not initialized
```

å‡ºç°è¯¥é”™è¯¯çš„åŸå› æ˜¯å› ä¸ºä½ åœ¨ä½¿ç”¨ Univer æ—¶æ²¡æœ‰åˆå§‹åŒ–è¯­è¨€ç¯å¢ƒã€‚ä½ éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥åˆå§‹åŒ–è¯­è¨€ç¯å¢ƒï¼š

```typescript {3-6}
const univer = new Univer({
  theme: defaultTheme,
  locale: LocaleType.ZH_CN,
  locales: {
      [LocaleType.ZH_CN]: zhCN,
  },
});
```