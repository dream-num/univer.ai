import { Callout } from 'nextra/components'
import BadgeGroup, { UniverTypes } from '@/components/BadgeGroup'
import ReactLive from '@/components/ReactLive'
import ServerNotice from '@/components/ServerNotice'
import VersionBadge from '@/components/VersionBadge'

# Using Custom Components in Univer
<BadgeGroup values={[UniverTypes.SHEET]} value={UniverTypes.SHEET} />

Univer provides multiple ways to integrate custom components, allowing you to extend and customize Univer's functionality. This guide will introduce several common methods.

## 1. Using Custom Components in the Sidebar

### openSidebar Method <VersionBadge version="0.3.0+" />

Use the `workbook.openSidebar()` method to open a sidebar containing custom components in the Univer interface.

```typescript
const sidebar = workbook.openSidebar({
  id: 'mySidebar',
  title: 'My Sidebar',
  component: MyCustomSidebarComponent,
});

// Close the sidebar later
sidebar.dispose();
```

## 2. Using Custom Components in Dialogs

### openDialog Method <VersionBadge version="0.3.0+" />

Use the `workbook.openDialog()` method to open a dialog containing custom components.

```typescript
const dialog = workbook.openDialog({
  id: 'myDialog',
  title: 'My Dialog',
  body: MyCustomDialogComponent,
});

// Close the dialog later
dialog.dispose();
```

## 3. Attaching Popups to Cells <VersionBadge version="0.2.10+" />

### attachPopup Method

* A Popup is a temporary DOM element attached to a cell, generally used to display temporary status information. It does not support persistent storage.
* Use the `range.attachPopup()` method to attach custom popups to specific cell ranges.

```typescript
const sheet = univerAPI.getActiveWorkbook().getActiveSheet();
const range = sheet.getRange(0, 0, 10, 10); // A1:J10

const disposable = range.attachPopup({
  componentKey: () => (
    <div style={{ width: 100, height: 100, background: '#fff' }}>
      Popup content
    </div>
  ),
  // If it's a Vue3 component, set isVue3: true
});

// Remove the popup
disposable.dispose();
```

## 4. Adding Floating DOM to Worksheets <VersionBadge version="0.2.10+" />

### addFloatDomToPosition Method

* The `@univerjs/sheet-drawing-ui` plugin needs to be installed before using this method.
* Floating DOM is a draggable component hovering over the sheet, which also supports persistent storage.
* Use the `worksheet.addFloatDomToPosition()` method to add a floating custom DOM element to the worksheet.

```typescript
const disposable = worksheet.addFloatDomToPosition({
  componentKey: ({ data }) => (
    <div style={{ width: '100%', height: '100%', background: '#fff' }}>
      Floating DOM content
      {data?.label}
    </div>
  ),
  initPosition: {
    startX: 100,
    endX: 200,
    startY: 100,
    endY: 200,
  },
  data: {
    label: 'Custom Label',
  },
});

// Remove the floating DOM
disposable.dispose();
```

## 5. Attaching Alert Popups <VersionBadge version="0.3.0+" />

### attachAlertPopup Method

Use the `range.attachAlertPopup()` method to attach an alert popup to the starting cell of a specified range.

```typescript
const range = sheet.getRange("A1:B2");
const alertDisposable = range.attachAlertPopup({
  key: "myAlert",
  message: "This is a warning!",
  type: "warning"
});

// Remove the alert later
alertDisposable.dispose();
```

## Notes

1. When using these methods, ensure that Univer has finished rendering.
2. For components that need registration, make sure they are correctly registered before use.
3. Use the `dispose()` method to clean up and remove added components to avoid memory leaks.
4. For Vue3 components, set `isVue3: true` in the options.

By using these methods, you can flexibly integrate various custom components in Univer, thereby enhancing and customizing Univer's functionality.