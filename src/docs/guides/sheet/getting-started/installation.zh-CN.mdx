import { Callout, Tabs } from 'nextra/components'
import ReactLive from '@/components/ReactLive'
import BadgeGroup, { UniverTypes } from '@/components/BadgeGroup'

# 安装和基本使用

<BadgeGroup values={[UniverTypes.SHEET, UniverTypes.DOC, UniverTypes.SLIDE]} value={UniverTypes.SHEET} />

Univer 从 0.5.0 版本起提供了 `@univerjs/presets` 包，它针对一些常见场景提供了预设的配置，可以帮助你快速地搭建一个 Univer 应用而无需关心如何引入和配置 Univer 插件。

<Callout type="info" emoji="🍃">
  如果你是首次使用 Univer，我们推荐从 Presets 开始。在后续的小节中，除非特殊说明，我们都会假设你使用了 Presets。如果你已经较为熟悉 Univer，并且希望更加灵活地引入插件（例如懒加载部分插件），可以参考 [高级引入方式](/guides/sheet/advanced-installation)。
</Callout>

## 使用包管理器

如果你的项目中已经引入了现代前端开发工具，那么引入 Univer 将会非常简单。我们推荐使用 [Vite](https://vitejs.dev/)、[esbuild](https://esbuild.github.io/) 或 [Webpack 5](https://webpack.js.org/) 等对 ES Module 支持较好的构建工具来构建 Univer 应用。如果你使用了其它构建工具（例如 Webpack 4），可能会需要一些额外的配置，请阅读 [常见问题](/guides/sheet/troubleshooting) 获取更多信息。

### 安装

选择你所使用的包管理器以安装 `@unvierjs/presets`：

<Tabs items={['pnpm', 'npm', 'yarn']}>
  <Tabs.Tab label="pnpm">
    ```shell
    pnpm add @univerjs/presets
    ```
  </Tabs.Tab>
  <Tabs.Tab label="npm">
    ```shell
    npm install @univerjs/presets
    ```
  </Tabs.Tab>
  <Tabs.Tab label="yarn">
    ```shell
    yarn add @univerjs/presets
    ```
  </Tabs.Tab>
</Tabs>

### 使用

仅仅十几行代码，你就可以启动一个电子表格应用并加载电子表格的基础功能：

```typescript
import { LocaleType, LogLevel } from '@univerjs/core';
import { defaultTheme } from '@univerjs/design';
import { createUniver } from '@univerjs/presets';
import { UniverSheetsBasicPreset } from '@univerjs/presets/sheets/sheets-basic';
import { enUS } from '@univerjs/presets/sheets/sheets-basic/en-US';

const { univerAPI } = createUniver({
    locale: LocaleType.ZH_CN, // set default locale 
    theme: defaultTheme, // set theme
    presets: [
        UniverSheetsBasicPreset({ locales: { enUS }, container: 'app' }),
    ],
});

univerAPI.createUniverSheet({ name: 'Test Sheet' });
```

export const code = `const univer = new Univer({
  theme: defaultTheme,
  locale: LocaleType.ZH_CN,
  locales: {
    [LocaleType.ZH_CN]: zhCN,
  },
});

univer.registerPlugin(UniverRenderEnginePlugin);
univer.registerPlugin(UniverFormulaEnginePlugin);

univer.registerPlugin(UniverUIPlugin, {
  container: 'app',
});

univer.registerPlugin(UniverDocsPlugin);
univer.registerPlugin(UniverDocsUIPlugin);

univer.registerPlugin(UniverSheetsPlugin);
univer.registerPlugin(UniverSheetsUIPlugin);
univer.registerPlugin(UniverSheetsFormulaPlugin);

univer.createUnit(UniverInstanceType.UNIVER_SHEET, {});`

<ReactLive code={code} />

### 更新

如果你使用的是 pnpm，你可以使用以下命令来更新所有的插件：

```shell
pnpm update "@univerjs/presets" @latest
```

## 通过 `<script>` 标签引入

如果你不使用包管理工具，你也可以通过 `<script>` 标签引入 Univer。

### 示例

我们在当前主流的 CDN 服务商（例如 jsDelivr、unpkg）都提供了 Univer 的 UMD 构建，你可以在 HTML 文件中引入这些资源（当然你也可以下载这些文件然后通过自己的服务器或者 CDN 网络分发）：

<Callout type="error">
  TODO: @jikkai 这里需要给 presets 打 UMD 包并指导用户引入
</Callout>

```html
<head>
  <script src="https://unpkg.com/@univerjs/umd/lib/univer.full.umd.js"></script>
  <script src="https://unpkg.com/@univerjs/umd/lib/locale/zh-CN.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/@univerjs/umd/lib/univer.css">
</head>
<body>
  <div id="app"></div>
 
  <script>
    const { univerAPI } = createUniver({
    logLevel: LogLevel.INFO, // set log level
    locale: LocaleType.ZH_CN, // set default locale 
    theme: defaultTheme, // set theme
    presets: [
        UniverSheetsBasicPreset({ locales: { enUS }, container: 'app' }), // univer container id
      ],
    });

    univerAPI.createUniverSheet({ name: 'Test Sheet' }); // create your first sheet
  </script>
</body>
```

这里返回的 `univerAPI` 对象被称为 Univer 的面板 API（Facade API），通过它可以调用 Univer 提供的许多功能。

### 指定版本

unpkg 和 jsDeliver 都支持指定特定版本的资源。以 unpkg 为例，如果你想使用 0.1.16 版本的 Univer，仅需在 URL 中加上 `@<version>` 来指定版本即可：

```diff
- https://unpkg.com/@univerjs/umd/lib/univer.full.umd.js
+ https://unpkg.com/@univerjs/umd@0.1.16/lib/univer.full.umd.js
```

## 表格基本操作

在上一小节的代码中，你已经创建了一个 Univer 实例并创建了一个空的电子表格，不过大部分情况下你可能需要的是在 Univer 当中加载已有数据。这一小节将会介绍如何向 Univer 加载数据、修改数据以及如何从 Univer 中存储数据。

### 加载数据

通过调用 `univerAPI` 的 `createUniverSheet` 方法，可以创建一个新的 `Workbook` 实例。方法的第一个参数是一个对象，包含了 `Workbook` 的数据，应该符合 `IWorkbookData` 接口。

```typescript
import { IWorkbookData, UniverInstanceType } from "@univerjs/core";

const data: IWorkbookData = {
  id: 'test',
  sheets: {
    sheet1: {
      id: 'sheet1',
      name: 'sheet1',
      cellData: {
        0: {
          0: {
            v: 'Hello Univer!',
          },
        },

      },
      rowCount: 100,
      columnCount: 100,
    },
  },
  locale: LocaleType.ZH_CN,
  name: 'Test Workbook',
  sheetOrder: ['sheet1'],
};
const workbook = univerAPI.createUniverSheet(data);
```

<Callout type="error">
  TODO: @jikkai 这里需要给 presets 打 UMD 包并指导用户引入
</Callout>

export const code2 = `const univer = new Univer({
  theme: defaultTheme,
  locale: LocaleType.ZH_CN,
  locales: {
    [LocaleType.ZH_CN]: zhCN,
  },
});

univer.registerPlugin(UniverRenderEnginePlugin);
univer.registerPlugin(UniverFormulaEnginePlugin);

univer.registerPlugin(UniverUIPlugin, {
  container: 'app',
});

univer.registerPlugin(UniverDocsPlugin);
univer.registerPlugin(UniverDocsUIPlugin);

univer.registerPlugin(UniverSheetsPlugin);
univer.registerPlugin(UniverSheetsUIPlugin);
univer.registerPlugin(UniverSheetsFormulaPlugin);

const data = {
        id: 'test',
        appVersion: '3.0.0-alpha',
        sheets: {
            sheet1: {
                id: 'sheet1',
                name: 'sheet1',
                cellData: {
                    0: {
                        0: {
                            v: 'Hello Univer!',
                        },
                    },
                    
                },
                rowCount: 100,
                columnCount: 100,
            },
        },
        locale: LocaleType.ZH_CN,
        name: '',
        sheetOrder: ['sheet1'],
        styles: {},
        resources: [
        ],
    };

univer.createUnit(UniverInstanceType.UNIVER_SHEET, data);`

<ReactLive code={code2} />

你可以在 [工作表数据结构](http://localhost:3000/zh-CN/guides/sheet/getting-started/workbook-data) 进一步了解如何初始化表格数据。

### 修改数据

你可以通过调用 `univerAPI` 的方法来使用 Univer 了，例如获取当前激活的，并在指定的范围更新值：

```typescript
const sheet = univerAPI.getActiveWorkbook().getActiveSheet();

const range = sheet.getRange(0, 0, 1, 1);
range.setValue(1);
```

<Callout type="error" emoji="🚨">
  Univer 基于 [命令系统](/guides/sheet/architecture/univer#%E5%91%BD%E4%BB%A4%E7%B3%BB%E7%BB%9F) 对状态和数据进行操作和更新，因此你**必须**使用 Facade API（或其对应的命令）来更新数据，任何直接对数据进行修改以更新视图的操作都不会生效。
</Callout>

### 存储数据

通过调用 `workbook` 的 `save` 方法，可以得到 `IWorkbookData` 对象，包含表格内部的最新数据。

```typescript
const savedData = univerAPI.getActiveWorkbook().save();
```

## 下一步

* 在 [基础概念](/guides/sheet/getting-started/concepts) 章节了解本章中出现的插件、命令和 Facade API 等概念。
* 在 [Presets](/guides/sheet/getting-started/presets) 章节了解 Univer 官方提供的所有 Presets。
* 在 [工作表数据结构](/guides/sheet/getting-started/workbook-data) 进一步了解如何初始化表格数据。
* 在 [功能](/guides/sheet/features/core) 相关章节中了解修改电子表格数据的所有操作。

[^1]: https://blog.npmjs.org/post/110924823920/npm-weekly-5
[^2]: https://pnpm.io/npmrc#auto-install-peers
[^3]: https://github.com/yarnpkg/yarn/issues/1503
