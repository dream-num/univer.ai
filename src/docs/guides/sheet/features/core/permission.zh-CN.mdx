import BadgeGroup, { UniverTypes } from '@/components/BadgeGroup'
import Sandbox from '@/components/Sandbox'
import Image from '@/components/Image'
import permissionImg from './permission/permission-cn.png'
import { Callout } from 'nextra/components'

import entryFile from './permission/demo-1/index.txt'

# æƒé™æ§åˆ¶

<BadgeGroup values={[UniverTypes.SHEET]} value={UniverTypes.SHEET} />

<Sandbox entryFile={entryFile} />

Univer æä¾›äº†æƒé™æ§åˆ¶çš„èƒ½åŠ›ï¼Œé€šå¸¸å¯ç”¨äºé™åˆ¶ç”¨æˆ·å¯¹å·¥ä½œç°¿ã€å·¥ä½œè¡¨ã€é€‰åŒºçš„æ“ä½œã€‚å½“ç”¨æˆ·è¿›è¡Œæ²¡æœ‰æƒé™çš„æ“ä½œæ—¶ï¼Œå¯ç»ˆæ­¢ä»£ç æ‰§è¡Œå¹¶æç¤ºç”¨æˆ·ç¼ºå¤±æƒé™ã€‚ä¾‹å¦‚ä½ å¯ä»¥åœ¨ä¸€ç‰‡é€‰åŒºå†…è®¾ç½®åŒºåŸŸä¿æŠ¤ï¼Œå°±å¯ä»¥è®¾ç½®å…¶ä»–åä½œè€…åœ¨è¯¥ä¿æŠ¤èŒƒå›´å†…æ˜¯å¦å¯ä»¥ä½¿ç”¨ç¼–è¾‘ã€é˜…è¯»ã€å¤åˆ¶ã€ç­›é€‰ç­‰ç­‰ã€‚

**æ³¨æ„ï¼šUniveræä¾›çš„æ˜¯å¯æ‹“å±•çš„åŸºç¡€èƒ½åŠ›ï¼Œå¹¶éå®šåˆ¶åŒ–çš„èƒ½åŠ›ï¼Œå¦‚æœæœ‰æŒä¹…åŒ–æˆ–è€…ç»„ç»‡æ¶æ„ç­‰æ›´ä¸°å¯Œå’Œæ›´å®šåˆ¶åŒ–çš„éœ€æ±‚ï¼Œéœ€è¦è‡ªè¡Œå®ç°æƒé™è§„åˆ™çš„å­˜å‚¨å’Œç»„ç»‡æ¶æ„æ¥å…¥ï¼Œè¿™é‡Œéœ€è¦ç¼–å†™è‡ªå®šä¹‰æ’ä»¶æ¥å®ç°ã€‚**
æ‰€ä»¥ä¼šå‡ºç°è®¾ç½®æƒé™åå»æŸ¥çœ‹æƒé™åˆ—è¡¨æ—¶æƒé™ä¿¡æ¯ä¸ºç©ºã€æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯æ—¶è¿”å›ä¸ºç©ºç­‰æƒ…å†µï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›ä¿¡æ¯éƒ½éœ€è¦èµ°æ¥å£è¯·æ±‚æ‹‰å–ï¼Œæ˜¯è‡ªå®šä¹‰çš„é€»è¾‘ éœ€è¦è‡ªå·±é¢å¤–è¡¥å……ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ç¬¬ä¸‰æ–¹æ¥å…¥ã€‚

## åŸºç¡€ç¤ºä¾‹

### å·¥ä½œç°¿æƒé™

ç›®å‰å·¥ä½œç°¿çš„æ•´ä½“æƒé™æ˜¯ç›´æ¥é€šè¿‡ API æ¥ä¿®æ”¹æƒé™ç‚¹ä½ï¼Œæˆ‘ä»¬æä¾›äº† [Facade API](/guides/sheet/getting-started/facade)ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ª API æ¥è®¾ç½®å·¥ä½œç°¿ä¸åŒåŠŸèƒ½çš„æƒé™ã€‚

æ‹¿ç¼–è¾‘æƒé™ä¸¾ä¾‹ï¼ˆå…¶ä»–åŠŸèƒ½åªéœ€æ›¿æ¢æƒé™ç‚¹ä½å³å¯ï¼Œ å…·ä½“çš„æƒé™ç‚¹ä½åˆ—ä¸¾åœ¨æ–‡ç« æœ€ä¸‹é¢ï¼Œ éœ€è¦ä» `@univerjs/sheets` ä¸­å¼•å…¥ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥è®¾ç½®æ•´ä½“å·¥ä½œç°¿ä¸å¯ç¼–è¾‘ï¼š

```typescript
import { FUniver } from "@univerjs/facade";

const univerAPI = FUniver.newAPI(univer);
```

ç„¶åä½ å°±å¯ä»¥é€šè¿‡è°ƒç”¨ `univerAPI` çš„æ–¹æ³•æ¥è·å– `FPermission` å¯¹è±¡ï¼Œä»è€Œæ“ä½œå…·ä½“çš„æƒé™è®¾ç½®ï¼š

```typescript
const permission = univerAPI.getPermission();
// unitId æ˜¯å·¥ä½œç°¿çš„ id, WorkbookEditablePermission æ˜¯æƒé™ç‚¹ä½, import { WorkbookEditablePermission } from '@univerjs/sheets' , false è¡¨ç¤ºè¯¥æƒé™ä¸å¯ä½¿ç”¨
permission.setWorkbookPermissionPoint(unitId, WorkbookEditablePermission, false)
```

### å·¥ä½œè¡¨æƒé™ä»£ç ç¤ºä¾‹

å·¥ä½œè¡¨å’Œé€‰åŒºç›¸å…³çš„æƒé™è®¾ç½®é€šè¿‡APIå’Œå‘½ä»¤æ¨¡å¼ä¸¤ç§æ–¹å¼æ¥æ‰§è¡Œï¼Œè¿™é‡Œä»¥å·¥ä½œè¡¨ç¼–è¾‘æƒé™ä¸¾ä¾‹ï¼Œå…¶ä»–å·¥ä½œè¡¨åŠŸèƒ½åªéœ€æ›¿æ¢æƒé™ç‚¹ä½å³å¯ï¼Œå…·ä½“çš„æƒé™ç‚¹ä½åˆ—ä¸¾åœ¨æ–‡ç« æœ€ä¸‹é¢ã€‚

#### API æ–¹å¼

```typescript
const permission = univerAPI.getPermission();
// åˆ›å»ºå·¥ä½œè¡¨æƒé™ï¼ŒunitId æ˜¯å·¥ä½œç°¿çš„ id, subUnitId æ˜¯å·¥ä½œè¡¨çš„ idï¼Œæ­¤æ—¶ç”Ÿæˆçš„æƒé™æ˜¯ä¸€ä¸ªåŸºç¡€æƒé™ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨äºæ¸²æŸ“æƒé™åŒºåŸŸ
const permissionId = await permission.addWorksheetBasePermission(unitId, subUnitId);
permission.setWorksheetPermissionPoint(unitId, subUnitId, WorksheetEditPermission, false);
```

#### å‘½ä»¤æ¨¡å¼

```typescript
const accessor = univer.__getInjector();
const commandService = accessor.get(ICommandService);
// import { getSheetCommandTarget } from '@univerjs/sheets';
const target = getSheetCommandTarget(univerInstanceService);
if (!target) {
  return;
}
const { unitId, subUnitId } = target;
commandService.executeCommand(AddWorksheetProtectionMutation.id, {
  unitId,
  subUnitId,
  rule: {
    permissionId: "2sxcza1",
    name: "sheet",
    unitType: 2,
    unitId,
    subUnitId,
  },
});

const permissionService = accessor.get(IPermissionService);
permissionService.updatePermissionPoint(new WorksheetEditPermission(unitId, subUnitId).id, false);
```

è¯¥å‘½ä»¤ä¸­çš„å‚æ•°ï¼š`permissionId` éœ€è¦è‡ªå·±ç”Ÿæˆçš„å”¯ä¸€ Id ç”¨æ¥å­˜å‚¨æƒé™ï¼Œ`unitType` æ˜¯å·¥ä½œè¡¨çš„ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»“åº“ä¸­çš„ UnitObject æšä¸¾æ¥æ›¿æ¢ä¸Šé¢çš„é­”æ³•æ•°ï¼Œ`unitId` æ˜¯å·¥ä½œç°¿çš„idï¼Œ`subUnitId` æ˜¯å·¥ä½œè¡¨çš„ idã€‚   

#### åˆ é™¤å·¥ä½œè¡¨æƒé™

åˆ é™¤å·²ç»å­˜åœ¨çš„å·¥ä½œè¡¨æƒé™å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¨¡å¼é©±åŠ¨ `DeleteWorksheetProtectionMutation`ï¼Œå‚æ•°æ˜¯ `unitId` å’Œ `subUnitId`ã€‚

```typescript
DeleteWorksheetProtectionMutationParams {
  unitId: string;
  subUnitId: string;
}
```

ä¹Ÿå¯ä»¥ä½¿ç”¨APIæ¥åˆ é™¤å·¥ä½œè¡¨çš„æ‰€æœ‰æƒé™è®¾ç½®

```typescript
const permission = univerAPI.getPermission();
permission.removeWorksheetPermission(unitId, subUnitId);
```

### è‡ªå®šä¹‰é€‰åŒºæƒé™ä»£ç ç¤ºä¾‹

é€‰åŒºçš„æƒé™åŒæ ·å¯ä»¥é€šè¿‡ API å’Œå‘½ä»¤æ¨¡å¼ä¸¤ç§æ–¹å¼æ¥æ‰§è¡Œï¼Œè¿™é‡Œä»¥é€‰åŒºç¼–è¾‘æƒé™ä¸¾ä¾‹ï¼Œå…¶ä»–é€‰åŒºåŠŸèƒ½åªéœ€æ›¿æ¢æƒé™ç‚¹ä½å³å¯ï¼Œå…·ä½“çš„æƒé™ç‚¹ä½åˆ—ä¸¾åœ¨æ–‡ç« æœ€ä¸‹é¢ã€‚

#### API æ–¹å¼

```typescript
const permission = univerAPI.getPermission();
const res = await permission.addRangeBaseProtection(unitId, subUnitId, ranges);
// è¿™é‡Œçš„è¿”å›åŒºåˆ«äºå·¥ä½œè¡¨æƒé™ï¼Œå› ä¸ºä¸€ä¸ªå­è¡¨ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªåŒºåŸŸä¿æŠ¤ï¼Œæ‰€ä»¥ ruleId æ˜¯ç”¨æ¥å­˜å‚¨è¯¥æƒé™è§„åˆ™çš„å”¯ä¸€ idï¼ŒpermissionId æ˜¯ç”¨æ¥æ‹¼æ¥æƒé™ç‚¹ä½çš„ã€‚
const { permissionId, ruleId } = res;
permission.setRangeProtectionPermissionPoint(unitId, subUnitId, permissionId, RangeProtectionPermissionEditPoint, false);
```

#### å‘½ä»¤æ¨¡å¼

```typescript
const accessor = univer.__getInjector();
const commandService = accessor.get(ICommandService);
const sheetSelectionManagerService = accessor.get(SheetsSelectionsService);
// import { getSheetCommandTarget } from '@univerjs/sheets';
const target = getSheetCommandTarget(univerInstanceService);
if (!target) {
  return;
}
const { unitId, subUnitId } = target;
const ranges = sheetSelectionManagerService.getCurrentSelections().map(selection => selection.range);
commandService.executeCommand(AddRangeProtectionMutation.id, {
  unitId,
  subUnitId,
  rules: [{
    permissionId: "3xtfxG1",
    name: "sheet1",
    unitType: 3,
    unitId,
    subUnitId,
    ranges,
    id: 'rule1'
  }],
});

const permissionService = accessor.get(IPermissionService);
// è¿™é‡Œ RangeProtectionPermissionEditPoint çš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ä¸Šé¢ç”Ÿæˆçš„ permissionIdï¼Œfalse è¡¨ç¤ºä¸å¯ç¼–è¾‘
permissionService.updatePermissionPoint(new RangeProtectionPermissionEditPoint(unitId, subUnitId, "3xtfxG1").id, false);
```

è¿™é‡Œé¢çš„å‚æ•°å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œå¢åŠ äº† `ranges` å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä½ é€‰ä¸­çš„åŒºåŸŸï¼Œ è¿˜æœ‰ä¸€ä¸ª `id` å‚æ•°, è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥æ ‡è¯†è¿™ä¸ªè§„åˆ™çš„å”¯ä¸€ idï¼Œç”¨æ¥åˆ é™¤è¿™ä¸ªè§„åˆ™ã€‚   


#### åˆ é™¤åŒºåŸŸä¿æŠ¤æƒé™

åˆ é™¤å·²ç»å­˜åœ¨çš„è‡ªå®šä¹‰åŒºåŸŸä¿æŠ¤å¯ä»¥é€šè¿‡å‘½ä»¤æ¨¡å¼é©±åŠ¨ `DeleteRangeProtectionMutation`ï¼Œå‚æ•°æ˜¯ `unitId` å’Œ `subUnitId` ä»¥åŠæƒ³æ‰¹é‡åˆ é™¤çš„ `ruleIds`ã€‚

```typescript
DeleteRangeProtectionMutationParams {
  unitId: string;
  subUnitId: string;
  ruleIds: string[];
}
```

ä¹Ÿå¯ä»¥ä½¿ç”¨APIæ¥åˆ é™¤é€‰åŒºçš„æ‰€æœ‰æƒé™è®¾ç½®

```typescript
const permission = univerAPI.getPermission();
permission.removeRangeProtection(unitId, subUnitId, ruleIds);
```

### å¦‚ä½•å»é™¤æƒé™å¼¹çª—
```typescript
const permission = univerAPI.getPermission();
permission.setPermissionDialogVisible(false);
```

## æ‹“å±•ä½¿ç”¨

è¿™é‡Œä»¥`WorkbookEditablePermission`ä¸¾ä¾‹ï¼Œåœ¨è‡ªå·±çš„æ’ä»¶ä¸­å¢åŠ æƒé™æ ¡éªŒï¼Œå…¶ä»–ç‚¹ä½ç±»ä¼¼

```typescript
import { WorkbookEditablePermission } from '@univerjs/sheets';
import { IPermissionService } from '@univerjs/core';

class YourService {
  constructor(@IPermissionService private _permissionService: IPermissionService) {

  }

  setWorkbookNotEditable() {
    this._permissionService.updatePermissionPoint(new WorkbookEditablePermission('unitId').id, false);
  }

  setWorkbookEditable() {
    this._permissionService.updatePermissionPoint(new WorkbookEditablePermission('unitId').id, true);
  }
}
```

ä½ ä¹Ÿå¯ä»¥æ‹“å±•ä¿®æ”¹åˆ«å¾—æƒé™ç‚¹ä½æ¥å®ç°å¯¹ä¸åŒåŠŸèƒ½çš„æƒé™æ§åˆ¶ï¼Œå…·ä½“ç‚¹ä½åˆ—è¡¨è¯·å‚è€ƒæ–‡ç« åº•éƒ¨ã€‚

### ç¬¬ä¸‰æ–¹æ’ä»¶å¦‚ä½•æ‰©å±•æƒé™ç‚¹ä½

```typescript
import { IPermissionService, IPermissionPoint } from '@univerjs/core';

export class CustomPermissionPoint implements IPermissionPoint {
  type = UnitObject.Unkonwn; // your type
  subType = UnitAction.View; // your subType
  status = PermissionStatus.INIT;
  value = true; // æƒé™çš„åˆå§‹å€¼
  id: string;
  constructor(unitId: string, subUnitId: string, customId: string) {
    // è¿™é‡Œè‡ªè¡Œæ‹¼å‡‘ä¸€ä¸ª idï¼Œid å±æ€§éœ€è¦ä¿è¯åœ¨æ•´ä¸ª IPermissionService ä¸­æ˜¯å”¯ä¸€çš„å‡­è¯ã€‚
    this.id = `${unitId}.${subUnitId}.${customId}`;
  }
}

class YourService {
  constructor(@IPermissionService private _permissionService: IPermissionService) {
    this._init()
  }

  _init() {
    this._permissionService.addPermissionPoint(new CustomPermissionPoint('unitId', 'subUnitId', 'my-id'));
  }
}

// åœ¨å…¶ä»–åœ°æ–¹å¦‚ä½•ä½¿ç”¨
class ConsumeService {
  constructor(@IPermissionService private _permissionService: IPermissionService) {
  }

  doSomething() {
   const point = this._permissionService.getPermissionPoint(new CustomPermissionPoint('unitId', 'subUnitId', 'my-id').id);
   console.log(point.value);
  }

  bindEvent() {
    // è¿™å°†è·å¾—ä¸€ä¸ª Rx å¯¹è±¡ï¼Œä½¿å¾—ä½ èƒ½å¤Ÿç›‘å¬å½“å‰æƒé™çš„å˜åŒ–ä½œå‡ºä¸€äº›æ”¹å˜
    const pount$ = this._permissionService.getPermissionPoint$(new CustomPermissionPoint('unitId', 'subUnitId', 'my-id').id);
    console.log(pount$);
  }
}
```

### ç¬¬ä¸‰æ–¹æƒé™æœåŠ¡æ¥å…¥(è¿›é˜¶ç”¨æ³•)

<Callout type="warning" emoji=" ğŸš¨ ">
  **å·²ç»å¼€å§‹æ¥å…¥è‡ªå®šä¹‰æƒé™ï¼Œå¯ä»¥ç›´æ¥æ“ä½œæ›´ç»†ç²’åº¦çš„æƒé™ç‚¹ä½ï¼Œå»ºè®®ä¸è¦å’Œ Permission Facade Api æ··ç”¨ã€‚**
</Callout>

æƒé™çš„åˆ¤æ–­é€»è¾‘é€šå¸¸æ˜¯ç”±ä¸€ä¸ªå¤–ç½®æœåŠ¡æ¥å•ç‹¬å¤„ç†ï¼Œè¿™éƒ¨åˆ†ä¸€èˆ¬ä¼šå¸¦æœ‰ä¸€ä¸ªé€šä¿¡æµç¨‹ï¼Œåœ¨çº¯å‰ç«¯ sdk å®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ [AuthzIoLocalService](https://github.com/dream-num/univer/blob/dev/packages/core/src/services/authz-io/authz-io-local.service.ts) æ¥æ‰¿è½½è¿™éƒ¨åˆ†é€»è¾‘ã€‚

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™éƒ¨åˆ†å®ç°è½¬ç”±åç«¯å®ç°ï¼Œå‰ç«¯éœ€è¦åŸºäº [IAuthzIoService](https://github.com/dream-num/univer/blob/dev/packages/core/src/services/authz-io/type.ts) ç±»å‹å®ç°å¯¹åº”çš„è¯·æ±‚å‡½æ•°ï¼Œæ¥è¿›è¡Œè¿è¡Œæ—¶çš„æ›¿æ¢ã€‚

<Image src={permissionImg} alt="Permission"  />

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ç”¨æ¥å±•ç¤ºé¢„è®¾ 2 ä¸ªè§’è‰²( æ‰€æœ‰è€…/é˜…è¯»è€…) æƒ…å†µä¸‹åŒºåŸŸä¿æŠ¤æƒé™ç‚¹ä½çš„å¢åˆ .
æ‰€æœ‰è€…æ‹¥æœ‰ä¿æŠ¤åŒºåŸŸçš„ç¼–è¾‘/æŸ¥çœ‹æƒé™,è€Œé˜…è¯»è€…ä¸èƒ½ç¼–è¾‘ä¹Ÿä¸èƒ½æŸ¥çœ‹ä¿æŠ¤åŒºåŸŸå†…å•å…ƒæ ¼çš„å†…å®¹.

```typescript
import { IAuthzIoService, Injector, Univer, Inject, generateRandomId, IResourceManagerService, createDefaultUser, isDevRole, UserManagerService } from '@univerjs/core';
import { ObjectScope, UnitAction, UnitObject, UnitRole, UniverType } from '@univerjs/protocol';
import type { IActionInfo, IAllowedRequest, IBatchAllowedResponse, ICollaborator, ICreateRequest, ICreateRequest_SelectRangeObject, IListPermPointRequest, IPermissionPoint, IPutCollaboratorsRequest, IUnitRoleKV, IUpdatePermPointRequest } from '@univerjs/protocol';

class YourAuthzService implements IAuthzIoService {
    private _permissionMap: Map<string, ICreateRequest_SelectRangeObject & { objectType: UnitObject }> = new Map([]);

    constructor(
        @IResourceManagerService private _resourceManagerService: IResourceManagerService,
        @Inject(UserManagerService) private _userManagerService: UserManagerService
    ) {
        this._initSnapshot();
        this._initDefaultUser();
    }

    private _initDefaultUser() {
        const currentUser = this._userManagerService.getCurrentUser();
        const currentUserIsValid = currentUser && currentUser.userID;
        if (!currentUserIsValid) {
            this._userManagerService.setCurrentUser(createDefaultUser(UnitRole.Owner));
        }
    }

    private _getRole(type: UnitRole) {
        const user = this._userManagerService.getCurrentUser();
        if (!user) {
            return false;
        }
        return isDevRole(user.userID, type);
    }

    private _initSnapshot() {
        this._resourceManagerService.registerPluginResource({
            toJson: (_unitId: string) => {
                const obj = [...this._permissionMap.keys()].reduce((r, k) => {
                    const v = this._permissionMap.get(k);
                    r[k] = v!;
                    return r;
                }, {} as Record<string, ICreateRequest_SelectRangeObject & { objectType: UnitObject }>);
                return JSON.stringify(obj);
            },
            parseJson: (json: string) => {
                return JSON.parse(json);
            },
            pluginName: 'SHEET_AuthzIoMockService_PLUGIN',
            businesses: [UniverType.UNIVER_SHEET, UniverType.UNIVER_DOC, UniverType.UNIVER_SLIDE],
            onLoad: (_unitId, resource) => {
                for (const key in resource) {
                    this._permissionMap.set(key, resource[key]);
                }
            },
            onUnLoad: () => {
                this._permissionMap.clear();
            },
        });
    }

    async create(config: ICreateRequest): Promise<string> {
        const permissionId = generateRandomId(8);
        if (config.objectType === UnitObject.SelectRange && config.selectRangeObject) {
            this._permissionMap.set(permissionId, { ...config.selectRangeObject, objectType: config.objectType });
        }
        return permissionId;
    }

    async batchAllowed(config: IAllowedRequest[]): Promise<IBatchAllowedResponse['objectActions']> {
        const selectionRangeConfig = config.filter((c) => c.objectType === UnitObject.SelectRange);
        if (selectionRangeConfig.length) {
            const currentUser = this._userManagerService.getCurrentUser();
            const res = [] as IBatchAllowedResponse['objectActions'];
            selectionRangeConfig.forEach((c) => {
                res.push({
                    unitID: c.unitID,
                    objectID: c.objectID,
                    actions: c.actions.map((action) => {
                        if (isDevRole(currentUser.userID, UnitRole.Owner)) {
                            return { action, allowed: true };
                        }
                        return { action, allowed: false };
                    }),
                });
            });
            return res;
        }
        return Promise.resolve([]);
    }

    async list(config: IListPermPointRequest): Promise<IPermissionPoint[]> {
        const result: IPermissionPoint[] = [];
        config.objectIDs.forEach((objectID) => {
            const rule = this._permissionMap.get(objectID);
            if (rule) {
                const item = {
                    objectID,
                    unitID: config.unitID,
                    objectType: rule!.objectType,
                    name: rule!.name,
                    shareOn: false,
                    shareRole: UnitRole.Owner,
                    shareScope: -1,
                    scope: {
                        read: ObjectScope.AllCollaborator,
                        edit: ObjectScope.AllCollaborator,
                    },
                    creator: createDefaultUser(UnitRole.Owner),
                    strategies: [
                        {
                            action: UnitAction.View,
                            role: UnitRole.Owner,
                        },
                        {
                            action: UnitAction.Edit,
                            role: UnitRole.Owner,
                        },
                    ],
                    actions: config.actions.map((a) => {
                        return { action: a, allowed: this._getRole(UnitRole.Owner) };
                    }),
                };
                result.push(item);
            }
        });
        return result;
    }

    async listCollaborators(): Promise<ICollaborator[]> {
        // List the existing collaborators
        return [];
    }

    async allowed(_config: IAllowedRequest): Promise<IActionInfo[]> {
        // Because this is a mockService for handling permissions, we will not write real logic in it. We will only return an empty array to ensure that the permissions originally set by the user are not modified.
        // If you want to achieve persistence of permissions, you can modify the logic here.
        return Promise.resolve([]);
    }

    async listRoles(): Promise<{ roles: IUnitRoleKV[]; actions: UnitAction[] }> {
        return {
            roles: [],
            actions: [],
        };
    }

    async update(config: IUpdatePermPointRequest): Promise<void> {
        // Update bit information
    }

    async updateCollaborator(): Promise<void> {
        // Update collaborator information
        return undefined;
    }

    async createCollaborator(): Promise<void> {
        // Create new collaborator information
        return undefined;
    }

    async deleteCollaborator(): Promise<void> {
        return undefined;
    }

    async putCollaborators(config: IPutCollaboratorsRequest): Promise<void> {
        return undefined;
    }
}

export class YourPlugin extends Plugin {
  override onStarting(injector: Injector): void {
    injector.add([IAuthzIoService, { useClass: YouAuthzService }]);
  }
}

// é€šè¿‡å°† override é€‰é¡¹è®¾ç½®ä¸º [[IAuthzIoService, null]]ï¼Œå¯ä»¥å‘Šè¯‰ Univer ä¸è¦æ³¨å†Œå†…ç½®çš„ IAuthzIoServiceã€‚
// è¿™æ ·ï¼ŒUniver å°†ä½¿ç”¨ä½ åœ¨ YourAuthzService ä¸­æä¾›çš„æœåŠ¡ä½œä¸ºæƒé™æœåŠ¡çš„å®ç°ã€‚
const univer = new Univer({
  override: [[IAuthzIoService, null]],
});

univer.registerPlugin(YourPlugin);
```

## æƒé™ç‚¹ä½åˆ—è¡¨

ä¸åŒçš„åŠŸèƒ½æƒé™æ˜¯ç”±ä¸åŒçš„æƒé™ç‚¹ä½æ¥æ§åˆ¶çš„ï¼Œä¿®æ”¹è¯¥ç‚¹ä½çš„å€¼å¯ä»¥æ§åˆ¶å¯¹åº”åŠŸèƒ½çš„æƒé™ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„æƒé™ç‚¹ä½ï¼Œå…·ä½“çš„ç‚¹ä½ä»£ç ï¼Œè¯·å‚é˜…[è¿™é‡Œ](https://github.com/dream-num/univer/tree/dev/packages/sheets/src/services/permission/permission-point)ã€‚

å¦‚æœ `workbook` çš„æƒé™æ§åˆ¶å’Œ `worksheet` / `range` æœ‰äº¤å‰ï¼Œé‚£ä¹ˆå¿…é¡»å…¨éƒ¨ä¸º `true` æ‰èƒ½ä½¿ç”¨ã€‚ä¾‹å¦‚ä¸€ä¸ªå•å…ƒæ ¼çš„ç¼–è¾‘æƒé™å¿…é¡» `workbook` å’Œ `worksheet` çš„ç¼–è¾‘æƒé™éƒ½ä¸º `true` æ‰èƒ½ç¼–è¾‘ã€‚

### Workbook å·¥ä½œç°¿

| Permission | Description |
| --- | --- |
| WorkbookEditablePermission | èƒ½å¦ç¼–è¾‘ |
| WorkbookPrintPermission | èƒ½å¦æ‰“å° |
| WorkbookCommentPermission | èƒ½å¦è¯„è®º |
| WorkbookViewPermission | èƒ½å¦æŸ¥çœ‹ |
| WorkbookCopyPermission | èƒ½å¦å¤åˆ¶ |
| WorkbookExportPermission | èƒ½å¦å¯¼å‡º |
| WorkbookManageCollaboratorPermission | èƒ½å¦ç®¡ç†åä½œè€… |
| WorkbookCreateSheetPermission | èƒ½å¦åˆ›å»ºå·¥ä½œè¡¨ |
| WorkbookDeleteSheetPermission | èƒ½å¦åˆ é™¤å·¥ä½œè¡¨ |
| WorkbookRenameSheetPermission | èƒ½å¦é‡å‘½åå·¥ä½œè¡¨ |
| WorkbookHideSheetPermission | èƒ½å¦éšè—å·¥ä½œè¡¨ |
| WorkbookDuplicateSheetPermission | èƒ½å¦å¤åˆ¶å·¥ä½œè¡¨ |
| WorkbookSharePermission | èƒ½å¦åˆ†äº« |
| WorkbookMoveSheetPermission | èƒ½å¦ç§»åŠ¨å·¥ä½œè¡¨ |
| WorksheetViewHistoryPermission | èƒ½å¦æŸ¥çœ‹å†å²è®°å½• |
| WorksheetRecoverHistoryPermission | èƒ½å¦æ¢å¤å†å²è®°å½• |

### Worksheet å·¥ä½œè¡¨

| Permission | Description |
| --- | --- |
| WorksheetCopyPermission | èƒ½å¦å¤åˆ¶ |
| WorksheetDeleteColumnPermission | èƒ½å¦åˆ é™¤åˆ— |
| WorksheetDeleteRowPermission | èƒ½å¦åˆ é™¤è¡Œ |
| WorksheetFilterPermission | èƒ½å¦è¿‡æ»¤ |
| WorksheetInsertColumnPermission | èƒ½å¦æ’å…¥åˆ— |
| WorksheetInsertHyperlinkPermission | èƒ½å¦ä½¿ç”¨è¶…é“¾æ¥ |
| WorksheetInsertRowPermission | èƒ½å¦æ’å…¥è¡Œ |
| WorksheetPivotTablePermission | èƒ½å¦ä½¿ç”¨é€è§†è¡¨ |
| WorksheetSetCellStylePermission | èƒ½å¦ç¼–è¾‘å•å…ƒæ ¼æ ·å¼ |
| WorksheetSetCellValuePermission | èƒ½å¦ç¼–è¾‘å•å…ƒæ ¼å€¼ |
| WorksheetSetColumnStylePermission | èƒ½å¦è®¾ç½®åˆ—æ ·å¼ |
| WorksheetSetRowStylePermission | èƒ½å¦è®¾ç½®è¡Œæ ·å¼ |
| WorksheetSortPermission | èƒ½å¦æ’åº |
| WorksheetViewPermission | èƒ½å¦æŸ¥çœ‹ |
| WorksheetEditPermission | èƒ½å¦ç¼–è¾‘ |

### Range åŒºåŸŸä¿æŠ¤

| Permission | Description |
| --- | --- |
| RangeProtectionPermissionViewPoint | èƒ½å¦æŸ¥çœ‹ä¿æŠ¤åŒºåŸŸçš„å†…å®¹ |
| RangeProtectionPermissionEditPoint | èƒ½å¦ç¼–è¾‘ä¿æŠ¤åŒºåŸŸ |
